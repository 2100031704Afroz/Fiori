<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiori App Data Extractor</title>
    <style>
        body {
            font-family: 'Segoe UI', Roboto, -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 25px;
            background-color: #f7f9fc;
            color: #333;
            line-height: 1.5;
        }

        .container {
            border: none;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            background-color: #fff;
        }

        h1 {
            color: #0066cc;
            margin-top: 0;
            font-weight: 600;
            margin-bottom: 25px;
            font-size: 28px;
        }

        h2 {
            color: #1a73e8;
            font-weight: 500;
            margin-top: 5px;
            font-size: 22px;
        }

        h3 {
            color: #444;
            font-size: 18px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 15px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 15px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="text"]:focus {
            border-color: #0066cc;
            box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.2);
            outline: none;
        }

        input[type="text"]::placeholder {
            color: #aaa;
        }

        button {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 16px;
            transition: background-color 0.2s, transform 0.1s;
        }

        button:hover {
            background-color: #0052a3;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 30px;
            color: #555;
            font-size: 16px;
        }

        .error {
            color: #d32f2f;
            margin-top: 15px;
            display: none;
            padding: 12px 16px;
            background-color: #fdeaea;
            border-radius: 6px;
            border-left: 4px solid #d32f2f;
            font-weight: 500;
        }

        .data-section {
            margin-bottom: 30px;
            position: relative;
            padding: 5px;
        }

        .data-section h3 {
            display: inline-block;
            margin-right: 15px;
            margin-bottom: 15px;
        }

        .copy-btn {
            background-color: #43a047;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            vertical-align: middle;
            transition: background-color 0.2s;
        }

        .copy-btn:hover {
            background-color: #388e3c;
        }

        .copy-all {
            display: inline-block;
            margin-left: 10px;
        }

        .copy-success {
            color: #388e3c;
            font-size: 13px;
            margin-left: 10px;
            display: none;
            font-weight: 500;
        }

        .data-item {
            border-left: 4px solid #0066cc;
            margin-bottom: 15px;
            background-color: #f8fbff;
            padding: 12px 16px;
            border-radius: 4px;
            transition: box-shadow 0.2s;
        }

        .data-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .data-item p {
            margin: 6px 0;
        }

        .data-item strong {
            color: #0066cc;
            font-weight: 500;
        }

        .data-item-details {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        .copy-text-area {
            margin-top: 15px;
            width: 100%;
            padding: 12px;
            background-color: #f9fafb;
            border: 1px dashed #ccc;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre;
            max-height: 180px;
            overflow-y: auto;
            display: none;
            color: #555;
            font-size: 14px;
        }

        .app-info {
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8fbff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .app-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #0066cc;
        }

        .app-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .app-meta-item {
            display: flex;
            align-items: center;
        }

        .app-meta-label {
            font-weight: 600;
            margin-right: 6px;
            color: #555;
        }

        .deprecated-warning {
            background-color: #fff3f3;
            border-left: 5px solid #f44336;
            padding: 14px 18px;
            margin-top: 15px;
            margin-bottom: 15px;
            font-weight: 500;
            color: #d32f2f;
            display: flex;
            align-items: center;
            border-radius: 4px;
        }

        .deprecated-icon {
            margin-right: 12px;
            font-size: 20px;
        }

        .app-info-section {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Fiori App Data Extractor</h1>
        <div class="form-group">
            <label for="fioriId">Fiori App ID:</label>
            <input type="text" id="fioriId" placeholder="e.g., F1048">
        </div>
        <div class="form-group">
            <label for="releaseId">Release ID:</label>
            <input type="text" id="releaseId" placeholder="e.g., S30PCE">
        </div>
        <button id="fetchButton">Fetch Data</button>

        <div class="loading" id="loading">
            <p>Loading data, please wait...</p>
        </div>

        <div class="error" id="error"></div>

        <div class="app-info-section" id="appInfoSection">
            <div class="app-info" id="appInfo">
                <!-- App information will be displayed here -->
            </div>
        </div>

        <div class="results" id="results">
            <h2>Extracted Data</h2>
            <div class="data-section">
                <h3>OData Services</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyTechnicalNames">Copy All Names</button>
                    <span class="copy-success" id="copyTechnicalSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="technicalNamesText"></div>
                <div id="technicalNames"></div>
            </div>
            <div class="data-section">
                <h3>Business Roles</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyBusinessRoles">Copy All Names</button>
                    <span class="copy-success" id="copyBusinessSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="businessRolesText"></div>
                <div id="businessRoles"></div>
            </div>
            <div class="data-section">
                <h3>Technical Names</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyBSPNames">Copy All Names</button>
                    <span class="copy-success" id="copyBSPSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="bspNamesText"></div>
                <div id="bspNames"></div>
            </div>
            <div class="data-section">
                <h3>Technical Catalogs</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyTechnicalCatalogs">Copy All Names</button>
                    <span class="copy-success" id="copyTechnicalCatalogsSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="technicalCatalogsText"></div>
                <div id="technicalCatalogs"></div>
            </div>
            <div class="data-section">
                <h3>Spaces</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copySpaces">Copy All Names</button>
                    <span class="copy-success" id="copySpacesSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="spacesText"></div>
                <div id="spaces"></div>
            </div>
            <div class="data-section">
                <h3>Pages</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyPages">Copy All Names</button>
                    <span class="copy-success" id="copyPagesSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="pagesText"></div>
                <div id="pages"></div>
            </div>
            <div class="data-section">
                <h3>Related Apps</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyRelatedApps">Copy All Fiori IDs</button>
                    <span class="copy-success" id="copyRelatedAppsSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="relatedAppsText"></div>
                <div id="relatedApps"></div>
            </div>
            <div class="data-section">
                <h3>Target Mappings</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copySemanticObjects">Copy All Objects</button>
                    <span class="copy-success" id="copySemanticObjectsSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="semanticObjectsText"></div>
                <div id="semanticObjects"></div>
            </div>
            <div class="data-section">
                <h3>App Launchers</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyAppLaunchers">Copy All Names & Statuses</button>
                    <span class="copy-success" id="copyAppLaunchersSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="appLaunchersText"></div>
                <div id="appLaunchers"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('fetchButton').addEventListener('click', async function () {
            const fioriId = document.getElementById('fioriId').value.trim();
            const releaseId = document.getElementById('releaseId').value.trim();

            if (!fioriId || !releaseId) {
                showError('Please enter both Fiori App ID and Release ID');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('appInfoSection').style.display = 'none';

            try {
                document.getElementById('copyTechnicalNames').replaceWith(document.getElementById('copyTechnicalNames').cloneNode(true));
                document.getElementById('copyBusinessRoles').replaceWith(document.getElementById('copyBusinessRoles').cloneNode(true));
                document.getElementById('copyBSPNames').replaceWith(document.getElementById('copyBSPNames').cloneNode(true));
                document.getElementById('copyTechnicalCatalogs').replaceWith(document.getElementById('copyTechnicalCatalogs').cloneNode(true));
                document.getElementById('copySpaces').replaceWith(document.getElementById('copySpaces').cloneNode(true));
                document.getElementById('copyPages').replaceWith(document.getElementById('copyPages').cloneNode(true));
                document.getElementById('copyRelatedApps').replaceWith(document.getElementById('copyRelatedApps').cloneNode(true));
                document.getElementById('copySemanticObjects').replaceWith(document.getElementById('copySemanticObjects').cloneNode(true));
                document.getElementById('copyAppLaunchers').replaceWith(document.getElementById('copyAppLaunchers').cloneNode(true));

                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Request timed out after 30 seconds')), 30000);
                });

                // Fetch and display app details immediately
                const appDetails = await Promise.race([
                    cachedFetch('appDetails', () => fetchAppDetails(fioriId, releaseId), fioriId, releaseId),
                    timeoutPromise
                ]);
                displayAppInfo(appDetails);

                // Progressive rendering: fetch and display each section as soon as it's ready
                const fetchAndDisplay = async (endpoint, fetchFn, displayFn) => {
                    try {
                        const data = await Promise.race([
                            cachedFetch(endpoint, fetchFn, fioriId, releaseId),
                            timeoutPromise
                        ]);
                        displayFn(data);
                    } catch (e) {
                        // Optionally show error in section
                    }
                };

                fetchAndDisplay('technicalNames', () => retryFetch(() => fetchTechnicalNames(fioriId, releaseId)), displayTechnicalNames);
                fetchAndDisplay('businessRoles', () => retryFetch(() => fetchBusinessRoleNames(fioriId, releaseId)), displayBusinessRoles);
                fetchAndDisplay('bspNames', () => retryFetch(() => fetchBSPNames(fioriId, releaseId)), displayBSPNames);
                fetchAndDisplay('technicalCatalogs', () => retryFetch(() => fetchTechnicalCatalogs(fioriId, releaseId)), displayTechnicalCatalogs);
                fetchAndDisplay('spaces', () => retryFetch(() => fetchSpaces(fioriId, releaseId)), displaySpaces);
                fetchAndDisplay('pages', () => retryFetch(() => fetchPages(fioriId, releaseId)), displayPages);
                fetchAndDisplay('relatedApps', () => retryFetch(() => fetchRelatedApps(fioriId, releaseId)), displayRelatedApps);
                fetchAndDisplay('semanticObjects', () => retryFetch(() => fetchSemanticObjects(fioriId, releaseId)), displaySemanticObjects);
                fetchAndDisplay('appLaunchers', () => retryFetch(() => fetchAppLaunchers(fioriId, releaseId)), displayAppLaunchers);

                // Hide loading, show results as soon as any section is ready
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';
            } catch (error) {
                showError('Error fetching data: ' + error.message);
                document.getElementById('loading').style.display = 'none';
            }
        });

        async function retryFetch(fetchFn, maxRetries = 1) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await fetchFn();
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
                }
            }
        }

        // Simple in-memory cache for API results
        const apiCache = {};
        function getCacheKey(endpoint, fioriId, releaseId) {
            return `${endpoint}|${fioriId}|${releaseId}`;
        }

        async function cachedFetch(endpoint, fetchFn, fioriId, releaseId) {
            const key = getCacheKey(endpoint, fioriId, releaseId);
            if (apiCache[key]) {
                return apiCache[key];
            }
            const result = await fetchFn();
            apiCache[key] = result;
            return result;
        }

        // Enhance error display
        function showError(message) {
            const errorElement = document.getElementById('error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            // Auto-hide error after 5 seconds
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        async function fetchTechnicalCatalogs(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/SplitTechnicalCatalogs?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        function displayTechnicalCatalogs(technicalCatalogs) {
            const container = document.getElementById('technicalCatalogs');
            const textContainer = document.getElementById('technicalCatalogsText');
            container.innerHTML = '';

            if (technicalCatalogs.length === 0) {
                container.innerHTML = '<p>No Technical Catalogs found</p>';
                textContainer.textContent = '';
                return;
            }

            // Create a list of just the catalog names for easy copying
            const namesOnly = technicalCatalogs.map(item => item.TechincalCatalog);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyTechnicalCatalogs').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyTechnicalCatalogsSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            technicalCatalogs.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${item.TechincalCatalog}</strong></p>`;

                if (item.TechincalCatalogDescription) {
                    html += `<p class="data-item-details">Description: ${item.TechincalCatalogDescription}</p>`;
                }

                if (item.SystemAlias) {
                    html += `<p class="data-item-details">System Alias: ${item.SystemAlias}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        // Add this function to fetch semantic objects
        async function fetchSemanticObjects(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/SplitAdditionalIntents?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        // Add this function to display semantic objects
        function displaySemanticObjects(semanticObjects) {
            const container = document.getElementById('semanticObjects');
            const textContainer = document.getElementById('semanticObjectsText');
            container.innerHTML = '';

            if (semanticObjects.length === 0) {
                container.innerHTML = '<p>No Semantic Objects found</p>';
                textContainer.textContent = '';
                return;
            }

            // Create a list of key-value pairs for easy copying
            const keyValuePairs = semanticObjects.map(item => `${item.SemanticObject} : ${item.SemanticAction}`);
            textContainer.textContent = keyValuePairs.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copySemanticObjects').addEventListener('click', async () => {
                const success = await copyToClipboard(keyValuePairs.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copySemanticObjectsSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items as key-value pairs
            semanticObjects.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${item.SemanticObject}</strong> : <strong>${item.SemanticAction}</strong></p>`;

                if (item.MappingSignatureKeyVal) {
                    html += `<p class="data-item-details">Parameters: ${item.MappingSignatureKeyVal}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        // Add this function to fetch related apps
        async function fetchRelatedApps(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/Related_Apps?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        // Add this function to display related apps
        function displayRelatedApps(relatedApps) {
            const container = document.getElementById('relatedApps');
            const textContainer = document.getElementById('relatedAppsText');
            container.innerHTML = '';

            if (relatedApps.length === 0) {
                container.innerHTML = '<p>No Related Apps found</p>';
                textContainer.textContent = '';
                return;
            }

            // Create a list of just the Fiori IDs for easy copying (excluding App Names as requested)
            const idsOnly = relatedApps.map(item => item.FioriId);
            textContainer.textContent = idsOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyRelatedApps').addEventListener('click', async () => {
                const success = await copyToClipboard(idsOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyRelatedAppsSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items - showing both App Name and Fiori ID
            relatedApps.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${item.FioriId}</strong></p>`;

                if (item.AppName) {
                    html += `<p class="data-item-details">App Name: ${item.AppName}</p>`;
                }

                if (item.relationType) {
                    html += `<p class="data-item-details">Relation Type: ${item.relationType}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        async function fetchSpaces(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/SplitSpace?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        function displaySpaces(spaces) {
            const container = document.getElementById('spaces');
            const textContainer = document.getElementById('spacesText');
            container.innerHTML = '';

            if (spaces.length === 0) {
                container.innerHTML = '<p>No Spaces found</p>';
                textContainer.textContent = '';
                return;
            }

            // Create a list of just the space names for easy copying
            const namesOnly = spaces.map(item => item.SpaceName);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copySpaces').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copySpacesSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            spaces.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${item.SpaceName}</strong></p>`;

                if (item.SpaceTitle) {
                    html += `<p class="data-item-details">Title: ${item.SpaceTitle}</p>`;
                }

                if (item.SpaceDescription) {
                    html += `<p class="data-item-details">Description: ${item.SpaceDescription}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        async function fetchPages(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/SplitPage?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        function displayPages(pages) {
            const container = document.getElementById('pages');
            const textContainer = document.getElementById('pagesText');
            container.innerHTML = '';

            if (pages.length === 0) {
                container.innerHTML = '<p>No Pages found</p>';
                textContainer.textContent = '';
                return;
            }

            // Create a list of just the page names for easy copying
            const namesOnly = pages.map(item => item.PageName);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyPages').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyPagesSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            pages.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${item.PageName}</strong></p>`;

                if (item.PageTitle) {
                    html += `<p class="data-item-details">Title: ${item.PageTitle}</p>`;
                }

                if (item.PageDescription) {
                    html += `<p class="data-item-details">Description: ${item.PageDescription}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        async function fetchAppDetails(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(fioriId='${fioriId}',releaseId='${releaseId}',inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN')?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d;
        }

        function displayAppInfo(appData) {
            const container = document.getElementById('appInfo');
            const appInfoSection = document.getElementById('appInfoSection');

            if (!appData) {
                container.innerHTML = '<p>No app information available</p>';
                return;
            }

            let html = `
                <div class="app-title">${appData.Title || appData.AppName || 'Unknown App'}</div>
                <div class="app-meta">
                    <div class="app-meta-item">
                        <span class="app-meta-label">Fiori ID:</span>
                        <span>${appData.fioriId || 'N/A'}</span>
                    </div>
                    <div class="app-meta-item">
                        <span class="app-meta-label">Release:</span>
                        <span>${appData.ReleaseName || appData.releaseId || 'N/A'}</span>
                    </div>
                    <div class="app-meta-item">
                        <span class="app-meta-label">Application Type:</span>
                        <span>${appData.ApplicationType || 'N/A'}</span>
                    </div>
                    <div class="app-meta-item">
                        <span class="app-meta-label">UI Technology:</span>
                        <span>${appData.UITechnology || 'N/A'}</span>
                    </div>
                </div>
            `;

            // Check if app is deprecated
            if (appData.isPublished === 'Deprecated') {
                html += `
                    <div class="deprecated-warning">
                        <span class="deprecated-icon">⚠️</span>
                        This application is marked as DEPRECATED in this release
                    </div>
                `;
            }

            // Add Application Component if available
            if (appData.ApplicationComponent) {
                html += `
                    <div class="app-meta-item">
                        <span class="app-meta-label">Application Component:</span>
                        <span>${appData.ApplicationComponent} (${appData.ApplicationComponentText || ''})</span>
                    </div>
                `;
            }

            // Add BSP Name if available
            if (appData.BSPName) {
                html += `
                    <div class="app-meta-item">
                        <span class="app-meta-label">BSP Application:</span>
                        <span>${appData.BSPName}</span>
                    </div>
                `;
            }

            // Add UI5 Component ID if available
            if (appData.SAPUI5ComponentId) {
                html += `
                    <div class="app-meta-item">
                        <span class="app-meta-label">SAPUI5 Component ID:</span>
                        <span>${appData.SAPUI5ComponentId}</span>
                    </div>
                `;
            }

            container.innerHTML = html;
            appInfoSection.style.display = 'block';
        }

        async function fetchTechnicalNames(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/ODataServices?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        async function fetchBusinessRoleNames(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(fioriId='${fioriId}',releaseId='${releaseId}',inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN')/SplitBusinessRole?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        async function fetchBSPNames(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/ICFNodes?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        // Helper function to copy text to clipboard
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                console.error('Failed to copy: ', err);
                return false;
            }
        }

        function displayTechnicalNames(technicalNames) {
            const container = document.getElementById('technicalNames');
            const textContainer = document.getElementById('technicalNamesText');
            container.innerHTML = '';

            if (technicalNames.length === 0) {
                container.innerHTML = '<p>No Technical Names found</p>';
                textContainer.textContent = '';
                return;
            }

            // Create a list of just the names for easy copying
            const namesOnly = technicalNames.map(item => item.TechnicalName);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyTechnicalNames').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyTechnicalSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            technicalNames.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${item.TechnicalName}</strong></p>`;

                if (item.NameSpace) {
                    html += `<p class="data-item-details">Namespace: ${item.NameSpace}</p>`;
                }

                if (item.SoftwareComponentName) {
                    html += `<p class="data-item-details">Software Component: ${item.SoftwareComponentName}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        function displayBusinessRoles(businessRoles) {
            const container = document.getElementById('businessRoles');
            const textContainer = document.getElementById('businessRolesText');
            container.innerHTML = '';

            if (businessRoles.length === 0) {
                container.innerHTML = '<p>No Business Roles found</p>';
                textContainer.textContent = '';
                return;
            }

            // Sort to show leading roles first
            businessRoles.sort((a, b) => {
                if (a.isLeading === "X" && b.isLeading !== "X") return -1;
                if (a.isLeading !== "X" && b.isLeading === "X") return 1;
                return 0;
            });

            // Create a list of just the names for easy copying
            const namesOnly = businessRoles.map(role => role.BusinessRoleName);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyBusinessRoles').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyBusinessSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            businessRoles.forEach(role => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${role.BusinessRoleName}</strong>${role.isLeading === "X" ? ' (Leading Role)' : ''}</p>`;

                if (role.BusinessRoleDescription) {
                    html += `<p class="data-item-details">Description: ${role.BusinessRoleDescription}</p>`;
                }

                if (role.RoleID) {
                    html += `<p class="data-item-details">Role ID: ${role.RoleID}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        function displayBSPNames(bspNames) {
            const container = document.getElementById('bspNames');
            const textContainer = document.getElementById('bspNamesText');
            container.innerHTML = '';

            if (bspNames.length === 0) {
                container.innerHTML = '<p>No BSP Names found</p>';
                textContainer.textContent = '';
                return;
            }

            // Sort to show main (non-additional) BSPs first
            bspNames.sort((a, b) => a.isAdditional - b.isAdditional);

            // Create a list of just the names for easy copying
            const namesOnly = bspNames.map(bsp => bsp.BSPName);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyBSPNames').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyBSPSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            bspNames.forEach(bsp => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${bsp.BSPName}</strong>${bsp.isAdditional === 0 ? ' (Main BSP)' : ''}</p>`;

                if (bsp.AppName) {
                    html += `<p class="data-item-details">App Name: ${bsp.AppName}</p>`;
                }

                if (bsp.BSPApplicationURL) {
                    html += `<p class="data-item-details">URL: ${bsp.BSPApplicationURL}</p>`;
                }

                if (bsp.SAPUI5ComponentId) {
                    html += `<p class="data-item-details">UI5 Component ID: ${bsp.SAPUI5ComponentId}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        async function fetchAppLaunchers(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/SplitApplauncher?$format=json`;
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        function displayAppLaunchers(appLaunchers) {
            const container = document.getElementById('appLaunchers');
            const textContainer = document.getElementById('appLaunchersText');
            container.innerHTML = '';

            if (appLaunchers.length === 0) {
                container.innerHTML = '<p>No App Launchers found</p>';
                textContainer.textContent = '';
                return;
            }

            // Create a list of Title-Subtitle : Status for easy copying
            const keyValuePairs = appLaunchers.map(item => {
                let name = item.Title || '';
                if (item.Subtitle) name += '-' + item.Subtitle;
                return `${name} : ${item.Information}`;
            });
            textContainer.textContent = keyValuePairs.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyAppLaunchers').addEventListener('click', async () => {
                const success = await copyToClipboard(keyValuePairs.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyAppLaunchersSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items as Title-Subtitle : Status
            appLaunchers.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';
                let name = item.Title || '';
                if (item.Subtitle) name += '-' + item.Subtitle;
                let html = `<p><strong>${name}</strong> : <strong>${item.Information || ''}</strong></p>`;
                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        document.getElementById('fioriId').addEventListener('keypress', handleEnterKey);
        document.getElementById('releaseId').addEventListener('keypress', handleEnterKey);

        // Add event listeners to convert input to uppercase
        document.getElementById('fioriId').addEventListener('input', function (e) {
            e.target.value = e.target.value.toUpperCase();
        });
        document.getElementById('releaseId').addEventListener('input', function (e) {
            e.target.value = e.target.value.toUpperCase();
        });

        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission
                if (document.getElementById('fioriId').value === '' ||
                    document.getElementById('releaseId').value === '') {
                    showError('Please enter both Fiori App ID and Release ID');
                    return;
                }

                const fioriId = document.getElementById('fioriId').value.trim();
                const releaseId = document.getElementById('releaseId').value.trim();

                // Only trigger fetch if both fields have values
                if (fioriId && releaseId) {
                    document.getElementById('fetchButton').click();
                }
            }
        }
    </script>
</body>

</html>
