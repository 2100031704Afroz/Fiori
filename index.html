<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiori App Data Extractor</title>
    <style>
        body {
            font-family: 'Segoe UI', Roboto, -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 25px;
            background-color: #f7f9fc;
            color: #333;
            line-height: 1.5;
        }

        .container {
            border: none;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            background-color: #fff;
        }

        h1 {
            color: #0066cc;
            margin-top: 0;
            font-weight: 600;
            margin-bottom: 25px;
            font-size: 28px;
        }

        h2 {
            color: #1a73e8;
            font-weight: 500;
            margin-top: 5px;
            font-size: 22px;
        }

        h3 {
            color: #444;
            font-size: 18px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 15px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 15px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="text"]:focus {
            border-color: #0066cc;
            box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.2);
            outline: none;
        }

        input[type="text"]::placeholder {
            color: #aaa;
        }

        button {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 16px;
            transition: background-color 0.2s, transform 0.1s;
        }

        button:hover {
            background-color: #0052a3;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 30px;
            color: #555;
            font-size: 16px;
        }

        .error {
            color: #d32f2f;
            margin-top: 15px;
            display: none;
            padding: 12px 16px;
            background-color: #fdeaea;
            border-radius: 6px;
            border-left: 4px solid #d32f2f;
            font-weight: 500;
        }

        .data-section {
            margin-bottom: 30px;
            position: relative;
            padding: 5px;
        }

        .data-section h3 {
            display: inline-block;
            margin-right: 15px;
            margin-bottom: 15px;
        }

        .copy-btn {
            background-color: #43a047;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            vertical-align: middle;
            transition: background-color 0.2s;
        }

        .copy-btn:hover {
            background-color: #388e3c;
        }

        .copy-all {
            display: inline-block;
            margin-left: 10px;
        }

        .copy-success {
            color: #388e3c;
            font-size: 13px;
            margin-left: 10px;
            display: none;
            font-weight: 500;
        }

        .data-item {
            border-left: 4px solid #0066cc;
            margin-bottom: 15px;
            background-color: #f8fbff;
            padding: 12px 16px;
            border-radius: 4px;
            transition: box-shadow 0.2s;
        }

        .data-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .data-item p {
            margin: 6px 0;
        }

        .data-item strong {
            color: #0066cc;
            font-weight: 500;
        }

        .data-item-details {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        .copy-text-area {
            margin-top: 15px;
            width: 100%;
            padding: 12px;
            background-color: #f9fafb;
            border: 1px dashed #ccc;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre;
            max-height: 180px;
            overflow-y: auto;
            display: none;
            color: #555;
            font-size: 14px;
        }

        .app-info {
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8fbff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .app-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #0066cc;
        }

        .app-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .app-meta-item {
            display: flex;
            align-items: center;
        }

        .app-meta-label {
            font-weight: 600;
            margin-right: 6px;
            color: #555;
        }

        .deprecated-warning {
            background-color: #fff3f3;
            border-left: 5px solid #f44336;
            padding: 14px 18px;
            margin-top: 15px;
            margin-bottom: 15px;
            font-weight: 500;
            color: #d32f2f;
            display: flex;
            align-items: center;
            border-radius: 4px;
        }

        .deprecated-icon {
            margin-right: 12px;
            font-size: 20px;
        }

        .app-info-section {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Fiori App Data Extractor</h1>
        <div class="form-group">
            <label for="fioriId">Fiori App ID:</label>
            <input type="text" id="fioriId" placeholder="e.g., F1048">
        </div>
        <div class="form-group">
            <label for="releaseId">Release ID:</label>
            <input type="text" id="releaseId" placeholder="e.g., S30PCE">
        </div>
        <button id="fetchButton">Fetch Data</button>

        <div class="loading" id="loading">
            <p>Loading data, please wait...</p>
        </div>

        <div class="error" id="error"></div>

        <div class="app-info-section" id="appInfoSection">
            <div class="app-info" id="appInfo">
                <!-- App information will be displayed here -->
            </div>
        </div>

        <div class="results" id="results">
            <h2>Extracted Data</h2>
            <div class="data-section">
                <h3>OData Services</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyTechnicalNames">Copy All Names</button>
                    <span class="copy-success" id="copyTechnicalSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="technicalNamesText"></div>
                <div id="technicalNames"></div>
            </div>
            <div class="data-section">
                <h3>Business Roles</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyBusinessRoles">Copy All Names</button>
                    <span class="copy-success" id="copyBusinessSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="businessRolesText"></div>
                <div id="businessRoles"></div>
            </div>
            <div class="data-section">
                <h3>Technical Names</h3>
                <div class="copy-all">
                    <button class="copy-btn" id="copyBSPNames">Copy All Names</button>
                    <span class="copy-success" id="copyBSPSuccess">Copied!</span>
                </div>
                <div class="copy-text-area" id="bspNamesText"></div>
                <div id="bspNames"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('fetchButton').addEventListener('click', async function () {
            const fioriId = document.getElementById('fioriId').value.trim();
            const releaseId = document.getElementById('releaseId').value.trim();

            if (!fioriId || !releaseId) {
                showError('Please enter both Fiori App ID and Release ID');
                return;
            }

            // Show loading, hide results and error
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('appInfoSection').style.display = 'none';

            try {
                // Reset any existing copy event listeners to prevent duplicates
                document.getElementById('copyTechnicalNames').replaceWith(document.getElementById('copyTechnicalNames').cloneNode(true));
                document.getElementById('copyBusinessRoles').replaceWith(document.getElementById('copyBusinessRoles').cloneNode(true));
                document.getElementById('copyBSPNames').replaceWith(document.getElementById('copyBSPNames').cloneNode(true));

                // First fetch the main app details to check deprecation status
                const appDetails = await fetchAppDetails(fioriId, releaseId);

                // Display app details, including deprecation warning if applicable
                displayAppInfo(appDetails);

                // Fetch data from all three endpoints
                const [technicalNameData, businessRoleData, bspNameData] = await Promise.all([
                    fetchTechnicalNames(fioriId, releaseId),
                    fetchBusinessRoleNames(fioriId, releaseId),
                    fetchBSPNames(fioriId, releaseId)
                ]);

                // Display the results
                displayTechnicalNames(technicalNameData);
                displayBusinessRoles(businessRoleData);
                displayBSPNames(bspNameData);

                // Hide loading, show results
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';
            } catch (error) {
                showError('Error fetching data: ' + error.message);
                document.getElementById('loading').style.display = 'none';
            }
        });

        async function fetchAppDetails(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(fioriId='${fioriId}',releaseId='${releaseId}',inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN')?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d;
        }

        function displayAppInfo(appData) {
            const container = document.getElementById('appInfo');
            const appInfoSection = document.getElementById('appInfoSection');

            if (!appData) {
                container.innerHTML = '<p>No app information available</p>';
                return;
            }

            let html = `
                <div class="app-title">${appData.Title || appData.AppName || 'Unknown App'}</div>
                <div class="app-meta">
                    <div class="app-meta-item">
                        <span class="app-meta-label">Fiori ID:</span>
                        <span>${appData.fioriId || 'N/A'}</span>
                    </div>
                    <div class="app-meta-item">
                        <span class="app-meta-label">Release:</span>
                        <span>${appData.ReleaseName || appData.releaseId || 'N/A'}</span>
                    </div>
                    <div class="app-meta-item">
                        <span class="app-meta-label">Application Type:</span>
                        <span>${appData.ApplicationType || 'N/A'}</span>
                    </div>
                    <div class="app-meta-item">
                        <span class="app-meta-label">UI Technology:</span>
                        <span>${appData.UITechnology || 'N/A'}</span>
                    </div>
                </div>
            `;

            // Check if app is deprecated
            if (appData.isPublished === 'Deprecated') {
                html += `
                    <div class="deprecated-warning">
                        <span class="deprecated-icon">⚠️</span>
                        This application is marked as DEPRECATED in this release
                    </div>
                `;
            }

            // Add Application Component if available
            if (appData.ApplicationComponent) {
                html += `
                    <div class="app-meta-item">
                        <span class="app-meta-label">Application Component:</span>
                        <span>${appData.ApplicationComponent} (${appData.ApplicationComponentText || ''})</span>
                    </div>
                `;
            }

            // Add BSP Name if available
            if (appData.BSPName) {
                html += `
                    <div class="app-meta-item">
                        <span class="app-meta-label">BSP Application:</span>
                        <span>${appData.BSPName}</span>
                    </div>
                `;
            }

            // Add UI5 Component ID if available
            if (appData.SAPUI5ComponentId) {
                html += `
                    <div class="app-meta-item">
                        <span class="app-meta-label">SAPUI5 Component ID:</span>
                        <span>${appData.SAPUI5ComponentId}</span>
                    </div>
                `;
            }

            container.innerHTML = html;
            appInfoSection.style.display = 'block';
        }

        async function fetchTechnicalNames(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/ODataServices?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        async function fetchBusinessRoleNames(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(fioriId='${fioriId}',releaseId='${releaseId}',inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN')/SplitBusinessRole?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        async function fetchBSPNames(fioriId, releaseId) {
            const url = `https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/services/SingleApp.xsodata/Details(inpfioriId='${fioriId}',inpreleaseId='${releaseId}',inpLanguage='EN',fioriId='${fioriId}',releaseId='${releaseId}')/ICFNodes?$format=json`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            return data.d && data.d.results ? data.d.results : [];
        }

        // Helper function to copy text to clipboard
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                console.error('Failed to copy: ', err);
                return false;
            }
        }

        function displayTechnicalNames(technicalNames) {
            const container = document.getElementById('technicalNames');
            const textContainer = document.getElementById('technicalNamesText');
            container.innerHTML = '';

            if (technicalNames.length === 0) {
                container.innerHTML = '<p>No Technical Names found</p>';
                textContainer.textContent = '';
                return;
            }

            // Create a list of just the names for easy copying
            const namesOnly = technicalNames.map(item => item.TechnicalName);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyTechnicalNames').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyTechnicalSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            technicalNames.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${item.TechnicalName}</strong></p>`;

                if (item.NameSpace) {
                    html += `<p class="data-item-details">Namespace: ${item.NameSpace}</p>`;
                }

                if (item.SoftwareComponentName) {
                    html += `<p class="data-item-details">Software Component: ${item.SoftwareComponentName}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        function displayBusinessRoles(businessRoles) {
            const container = document.getElementById('businessRoles');
            const textContainer = document.getElementById('businessRolesText');
            container.innerHTML = '';

            if (businessRoles.length === 0) {
                container.innerHTML = '<p>No Business Roles found</p>';
                textContainer.textContent = '';
                return;
            }

            // Sort to show leading roles first
            businessRoles.sort((a, b) => {
                if (a.isLeading === "X" && b.isLeading !== "X") return -1;
                if (a.isLeading !== "X" && b.isLeading === "X") return 1;
                return 0;
            });

            // Create a list of just the names for easy copying
            const namesOnly = businessRoles.map(role => role.BusinessRoleName);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyBusinessRoles').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyBusinessSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            businessRoles.forEach(role => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${role.BusinessRoleName}</strong>${role.isLeading === "X" ? ' (Leading Role)' : ''}</p>`;

                if (role.BusinessRoleDescription) {
                    html += `<p class="data-item-details">Description: ${role.BusinessRoleDescription}</p>`;
                }

                if (role.RoleID) {
                    html += `<p class="data-item-details">Role ID: ${role.RoleID}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        function displayBSPNames(bspNames) {
            const container = document.getElementById('bspNames');
            const textContainer = document.getElementById('bspNamesText');
            container.innerHTML = '';

            if (bspNames.length === 0) {
                container.innerHTML = '<p>No BSP Names found</p>';
                textContainer.textContent = '';
                return;
            }

            // Sort to show main (non-additional) BSPs first
            bspNames.sort((a, b) => a.isAdditional - b.isAdditional);

            // Create a list of just the names for easy copying
            const namesOnly = bspNames.map(bsp => bsp.BSPName);
            textContainer.textContent = namesOnly.join('\n');
            textContainer.style.display = 'block';

            // Add copy button functionality
            document.getElementById('copyBSPNames').addEventListener('click', async () => {
                const success = await copyToClipboard(namesOnly.join('\n'));
                if (success) {
                    const successIndicator = document.getElementById('copyBSPSuccess');
                    successIndicator.style.display = 'inline';
                    setTimeout(() => { successIndicator.style.display = 'none'; }, 2000);
                }
            });

            // Display detailed items
            bspNames.forEach(bsp => {
                const div = document.createElement('div');
                div.className = 'data-item';

                let html = `<p><strong>${bsp.BSPName}</strong>${bsp.isAdditional === 0 ? ' (Main BSP)' : ''}</p>`;

                if (bsp.AppName) {
                    html += `<p class="data-item-details">App Name: ${bsp.AppName}</p>`;
                }

                if (bsp.BSPApplicationURL) {
                    html += `<p class="data-item-details">URL: ${bsp.BSPApplicationURL}</p>`;
                }

                if (bsp.SAPUI5ComponentId) {
                    html += `<p class="data-item-details">UI5 Component ID: ${bsp.SAPUI5ComponentId}</p>`;
                }

                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        function showError(message) {
            const errorElement = document.getElementById('error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        document.getElementById('fioriId').addEventListener('keypress', handleEnterKey);
        document.getElementById('releaseId').addEventListener('keypress', handleEnterKey);
        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission
                if (document.getElementById('fioriId').value === '' ||
                    document.getElementById('releaseId').value === '') {
                    showError('Please enter both Fiori App ID and Release ID');
                    return;
                }

                const fioriId = document.getElementById('fioriId').value.trim();
                const releaseId = document.getElementById('releaseId').value.trim();

                // Only trigger fetch if both fields have values
                if (fioriId && releaseId) {
                    document.getElementById('fetchButton').click();
                }
            }
        }
    </script>
</body>

</html>
